asyncapi: '2.6.0'
info:
  title: Allocation Service
  version: 1.0.0
  description: >
    Service responsible for managing product allocations and batches
    It subscribes to external commands (via Redis Pub/Sub or Streams) and
    publishes domain events after handling business logic

channels:
  change_batch_quantity:
    subscribe:
      summary: Command to change the batch quantity
      description: >
        The service listens to this channel to receive commands
        for updating the quantity of a specific batch
      message:
        name: ChangeBatchQuantity
        contentType: application/json
        payload:
          type: object
          properties:
            batchref:
              type: string
              description: Reference identifier of the batch to update
              example: "batch-001"
            qty:
              type: integer
              description: New total quantity for the batch
              minimum: 1
              example: 50
          required:
            - batchref
            - qty
        examples:
          - name: example-change-batch-quantity
            payload:
              batchref: "batch-001"
              qty: 50

  line_allocated:
    publish:
      summary: Product allocation event
      description: >
        The service publishes this event after successfully allocating
        an order line to a batch
      message:
        name: LineAllocated
        contentType: application/json
        payload:
          type: object
          properties:
            orderid:
              type: string
              description: Identifier of the order for which the product was allocated
              example: "order-123"
            sku:
              type: string
              description: Stock Keeping Unit (SKU) of the allocated product
              example: "RED-CHAIR"
            qty:
              type: integer
              description: Quantity of the allocated product
              minimum: 1
              example: 10
            batchref:
              type: string
              description: Reference identifier of the batch from which the allocation was made
              example: "batch-001"
          required:
            - orderid
            - sku
            - batchref
            - qty
        examples:
          - name: example-line-allocated
            payload:
              orderid: "order-123"
              sku: "RED-CHAIR"
              qty: 10
              batchref: "batch-001"
